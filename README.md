
# Схема устройства
![sensor](sensor.png)

# Использование библитеки SHT
[Этот репозиторий](https://github.com/Sensirion/embedded-sht) содержит несколько библиотек для устройств на разных микросхемах. Наш [датчик](https://amperka.ru/product/troyka-meteo-sensor) на основе SHT31, поэтому библиотека нужна sht3x. Её рекомендуется скачать из раздела [Релизы](https://github.com/Sensirion/embedded-sht/releases) репозитория. 

Датчик работает по протоколу I2C, и для его использования в нашей плате esp должен быть контроллер I2C. В esp8266 его нет, но можно его эмулировать. Библиотека SHT предлагает на выбор один из этих двух вариантов. В обоих случаях в файле sensirion_xw_i2c_implementation.c нужно имплементировать некоторые функции. Подробнее можно прочитать на [этой странице](https://github.com/Sensirion/embedded-common/tree/1ac7c72c895d230c6f1375865f3b7161ce6b665a) репозитория. 

В этом репозитории (smartthings-temperature-sensor) бииблиотека sht3x уже включена в проект как компонент и находится в директории components/sht3x. Функции в файле sensirion_sw_i2c_implmentation.c реализованы, и в них используются константы значений пинов GPIO_SDA и GPIO_SCL, которые определены в файле main/device_control.h. Без этих констант библиотека sht3x работать не будет. 
Также по правилам создания проектов с помощью ESP8266SDK каждый компонент должен содержать файл component.mk, а все заголовочные *.h файлы должны лежать в директории include, поэтому скачанная библиотека sht3x изменена под необходимое расположение файлов в проекте.  